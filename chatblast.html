<!DOCTYPE html>
<html>
<head>
  <title>ChatBlast</title>
</head>

<body>
<div>
  <strong>Message:</strong> <input id="update-text" type="input" placeholder="enter a message..."/>
  <input id="publish-button" type="submit" value="Publish"/>
  <p><strong>Updates</strong></p>
  <div id="messages-top"/>
</div>
</body>
<!-- Get PubNub javascript SDK-->
<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.27.4.min.js"></script>

<script>
  const messagesTop = document.getElementById('messages-top');
  const updateText = document.getElementById('update-text');
  const sendButton = document.getElementById('publish-button');
  sendButton.addEventListener(
      'click',
      () => {
          submitUpdate(updateText.value)
      }
  );

  const theChannel = 'bighats_d07621b22929';

  const pubnub = new PubNub({
    // replace the key placeholders with your own PubNub publish and subscribe keys
    publishKey: 'pub-c-392403c8-b1ff-42d1-bcec-2cc45eddb553',
    subscribeKey: 'sub-c-5f4f818e-778d-11ea-9128-3a1eb1802302',
    uuid: 'chatblast-user-123'
  });

  pubnub.addListener({
    message: function(event) {
      displayMessage('[MESSAGE: received]',
        event.message.author + ': ' + event.message.body);
    },
    presence: function(event) {
      displayMessage('[PRESENCE: ' + event.action + ']',
        'uuid: ' + event.uuid + ', channel: ' + event.channel);
    },
    status: function(event) {
      displayMessage('[STATUS: ' + event.category + ']',
        'connected to channels: ' + event.affectedChannels);

      if (event.category == 'PNConnectedCategory') {
        submitUpdate('Harmless.');
      }
    }
  });

  pubnub.subscribe({
    channels: [theChannel],
    withPresence: true
  });

  submitUpdate = function(message) {
    pubnub.publish({
      channel : theChannel,
      message : {
          author: 'jsTest',
          avatar: null,
          body: message,
          type: 'fan',
      }
    },
    function(status, response) {
      if (status.error) {
        console.log(status)
      }
      else {
        displayMessage('[PUBLISH: sent]',
          'timetoken: ' + response.timetoken);
      }
    });
  };

  displayMessage = function(messageType, aMessage) {
    let pmessage = document.createElement('p');
    let br = document.createElement('br');

    messagesTop.after(pmessage);
    pmessage.appendChild(document.createTextNode(messageType));
    pmessage.appendChild(br);
    pmessage.appendChild(document.createTextNode(aMessage));
  }
</script>
</html>
